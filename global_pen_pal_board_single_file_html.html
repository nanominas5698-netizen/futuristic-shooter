<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Global Pen‚ÄëPal Board ‚Äî Note in a Bottle</title>
<style>
  :root{--sea:#0ea5a1;--sea-deep:#04757a;--sand:#f7e9d7;--paper:#fffdf6;--accent:#ff6b6b}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
  body{background:linear-gradient(#bfeff2,#88d6e0 60%);display:flex;align-items:center;justify-content:center}
  .app{width:980px;max-width:96%;height:640px;background:linear-gradient(180deg,#c7f0f4 0%, #e6fbfd 40%, #dff7fb 100%);box-shadow:0 12px 40px rgba(2,6,23,.2);border-radius:18px;overflow:hidden;position:relative}
  header{height:76px;padding:14px 22px;display:flex;align-items:center;gap:12px}
  .logo{display:flex;gap:12px;align-items:center}
  .logo .icon{width:52px;height:52px;border-radius:12px;background:radial-gradient(circle at 30% 30%, #fff9e6, #ffd5a6);display:flex;align-items:center;justify-content:center;font-weight:800;color:#0b5560}
  h1{font-size:18px;margin:0;color:#064048}
  .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
  button, .btn{background:#fff;border:0;padding:8px 12px;border-radius:10px;box-shadow:0 6px 12px rgba(6,25,30,0.06);cursor:pointer}
  .main{display:flex;height:calc(100% - 76px)}
  .left{flex:1;background:linear-gradient(var(--sea),var(--sea-deep));position:relative;overflow:hidden}
  .right{width:360px;background:linear-gradient(180deg,#ffffffee,#ffffffcc);padding:18px;box-sizing:border-box;border-left:1px solid rgba(10,10,10,0.03);display:flex;flex-direction:column}
  #seaCanvas{width:100%;height:100%;display:block}
  .ui-card{background:rgba(255,255,255,0.06);backdrop-filter: blur(4px);padding:10px;border-radius:12px;position:absolute;left:18px;top:18px;color:#fff}
  .bubble{background:var(--paper);padding:8px;border-radius:10px;box-shadow: 0 6px 12px rgba(2,6,23,0.08);color:#06313a}
  form{display:flex;flex-direction:column;gap:8px}
  input[type=text], textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #eee;font-size:14px;resize:vertical}
  textarea{min-height:90px}
  .note-preview{min-height:70px;padding:10px;border-radius:10px;border:1px dashed #e6eef0;background:#fff}
  .section-title{font-weight:700;color:#064048;margin:6px 0}
  .index-list{flex:1;overflow:auto;padding-right:6px}
  .note-item{background:#fff;border-radius:8px;padding:8px;margin-bottom:8px;border:1px solid #f0f0f0}
  .muted{color:#6b7c7d;font-size:13px}
  footer{padding:10px;border-top:1px solid #f0f0f0;font-size:13px}
  .credits{font-size:13px;color:#064048}
  .tutorial-overlay{position:absolute;inset:0;background:linear-gradient(180deg, rgba(6,30,34,0.6), rgba(6,30,34,0.5));display:flex;align-items:center;justify-content:center;z-index:80}
  .tutorial-box{background:#fff;padding:18px;border-radius:12px;max-width:560px;color:#052d30}
  .code-input{display:flex;gap:8px}
  .locked{opacity:.6}
  .cooldown{color:#e65151;font-weight:700}
  .bottle{position:absolute;width:64px;height:64px;transition:transform .25s linear}
  .bottle.small{width:46px;height:46px}
  .topbar{display:flex;align-items:center;gap:10px}
  .badge{background:#fff;padding:6px 8px;border-radius:999px;font-weight:700}
</style>
</head>
<body>
<div class="app" id="app">
  <header>
    <div class="logo"><div class="icon">üåä</div><div><h1>Global Pen‚ÄëPal Board</h1><div class="muted">Drop a note in a bottle ‚Äî someone else will find it!</div></div></div>
    <div class="controls">
      <div class="badge" id="userBadge">Guest</div>
      <button id="openCredits" class="btn">Credits</button>
      <button id="openCodes" class="btn">Enter Code</button>
      <button id="resetBtn" class="btn">Reset</button>
    </div>
  </header>
  <div class="main">
    <div class="left">
      <canvas id="seaCanvas"></canvas>
      <div class="ui-card">
        <div class="topbar"><strong style="font-size:14px">Your Bottle</strong><div style="margin-left:8px" class="muted">Design:</div><div id="designTag" style="margin-left:6px;background:#fff;padding:5px;border-radius:6px;color:#064048">Classic</div></div>
      </div>
      <div style="position:absolute;right:18px;top:18px;color:#fff"><div class="muted">Collected</div><div id="collectedCount" style="font-weight:800;font-size:18px">0</div></div>
    </div>
    <div class="right">
      <div class="section-title">Welcome</div>
      <div class="muted">Enter your username to start</div>
      <div style="display:flex;gap:8px;margin-top:8px"><input id="username" type="text" placeholder="Your username" /><button id="setUser" class="btn">Start</button></div>
      <hr />
      <div class="section-title">Write a Note</div>
      <form id="noteForm">
        <input id="noteTitle" type="text" placeholder="Short title (optional)" maxlength="60" />
        <textarea id="noteBody" placeholder="Write your message... be kind!" maxlength="800"></textarea>
        <div class="muted">Preview</div>
        <div class="note-preview" id="preview">Your note will show here.</div>
        <div style="display:flex;gap:8px;margin-top:8px"><button id="sendBtn" type="button" class="btn">Send Bottle</button><div id="cooldownTag" style="align-self:center" class="muted"></div></div>
      </form>

      <div style="height:12px"></div>
      <div class="section-title">Index / Collection</div>
      <div class="muted">Your collected notes and unlocked designs</div>
      <div class="index-list" id="indexList"></div>

      <div style="height:12px"></div>
      <div class="section-title">Unlocks</div>
      <div class="muted">Send more notes to unlock designs</div>
      <div style="display:flex;gap:8px;margin-top:6px">
        <div class="note-item locked" id="unlock1">Sent 1 ‚Äî Classic (unlocked)</div>
        <div class="note-item locked" id="unlock2">Sent 5 ‚Äî Coral Bottle</div>
        <div class="note-item locked" id="unlock3">Sent 15 ‚Äî Starry Bottle</div>
      </div>
      <footer>
        <div class="credits">Creator: Admin Rex</div>
      </footer>
    </div>
  </div>

  <!-- Tutorial overlay -->
  <div id="tutorial" class="tutorial-overlay">
    <div class="tutorial-box">
      <h2>Welcome to the Sea</h2>
      <p>This is a tiny tutorial. You'll pick a username, write a note, and toss it in the sea. After sending a bottle you'll receive a mystery note from someone else using this site. Collect notes to fill your index and unlock bottle designs.</p>
      <ol>
        <li>Enter a username and click <strong>Start</strong>.</li>
        <li>Write a short note and click <strong>Send Bottle</strong>.</li>
        <li>Wait 10 seconds cooldown, then you can send again.</li>
      </ol>
      <div style="display:flex;gap:8px;margin-top:12px"><button id="tutorialGotIt" class="btn">Got it</button><button id="tutorialSkip" class="btn">Skip Tutorial</button></div>
    </div>
  </div>

  <!-- Credits Modal -->
  <div id="creditsModal" style="display:none;position:absolute;inset:0;background:rgba(6,30,34,0.45);z-index:90;align-items:center;justify-content:center">
    <div style="background:#fff;padding:18px;border-radius:12px;max-width:560px;color:#053033">
      <h3>Credits</h3>
      <p>Creator: <strong>Admin Rex</strong></p>
      <p>Engine: HTML/CSS/JS ‚Äî single file demo. This demo stores notes in your browser (localStorage) so it won't sync across different devices or browsers. For a real global experience you'd add a server and a database.</p>
      <div style="display:flex;gap:8px;margin-top:10px"><button id="closeCredits" class="btn">Close</button></div>
    </div>
  </div>

  <!-- Codes Modal -->
  <div id="codeModal" style="display:none;position:absolute;inset:0;background:rgba(6,30,34,0.45);z-index:90;align-items:center;justify-content:center">
    <div style="background:#fff;padding:18px;border-radius:12px;max-width:420px;color:#053033">
      <h3>Enter Code</h3>
      <div style="display:flex;gap:8px"><input id="codeInput" placeholder="Enter code" /><button id="applyCode" class="btn">Apply</button></div>
      <div class="muted" style="margin-top:8px">Codes: <strong>WELCOME</strong> (unlock Coral), <strong>STARFALL</strong> (unlock Starry), <strong>FREEBOTTLE</strong> (grants a mystery note)</div>
      <div style="display:flex;gap:8px;margin-top:12px"><button id="closeCodes" class="btn">Close</button></div>
    </div>
  </div>

</div>

<script>
/* Single-file Global Pen-Pal Board
   - Stores data in localStorage
   - Simulates sending/receiving by pooling notes in localStorage among users of the same browser
   - IMPORTANT: This is a client-side demo ‚Äî cross-device sending requires a backend. */

// Utilities
const qs = (s)=>document.querySelector(s);
const $sea = qs('#seaCanvas');
const ctx = $sea.getContext('2d');
let W, H;
function resize(){W = $sea.width = $sea.clientWidth; H = $sea.height = $sea.clientHeight;}
window.addEventListener('resize', ()=>{resize(); drawSea();});
resize();

// State
const state = {
  user: null,
  poolKey: 'gppb_pool',
  myKey: 'gppb_me',
  designs: ['Classic','Coral','Starry'],
  unlocked: {0:true,1:false,2:false},
  sendCount:0,
  collected: [],
  cooldownUntil:0
};

// Load saved state
function loadLocal(){
  try{
    const me = JSON.parse(localStorage.getItem(state.myKey)||'null');
    if(me){
      state.user = me.user; state.sendCount = me.sendCount||0; state.unlocked = me.unlocked||state.unlocked; state.collected = me.collected||[]; state.cooldownUntil = me.cooldownUntil||0;
    }
  }catch(e){console.warn(e)}
}
function saveLocal(){
  localStorage.setItem(state.myKey, JSON.stringify({user:state.user,sendCount:state.sendCount,unlocked:state.unlocked,collected:state.collected,cooldownUntil:state.cooldownUntil}));
}
loadLocal();

// Basic sea drawing (waves + floating bottles)
let floaters = [];
function createFloaters(){
  floaters = [];
  for(let i=0;i<10;i++){
    floaters.push({x:Math.random()*W,y:Math.random()*H*0.7+20,amp:10+Math.random()*26,phase:Math.random()*Math.PI*2,speed:0.2+Math.random()*0.6,design: state.designs[Math.floor(Math.random()*state.designs.length)]});
  }
}
createFloaters();
function drawSea(t=0){
  ctx.clearRect(0,0,W,H);
  // background gradient
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#a6f0f3'); g.addColorStop(0.6,'#07a2a9'); g.addColorStop(1,'#036b73');
  ctx.fillStyle = g; ctx.fillRect(0,0,W,H);
  // waves
  ctx.fillStyle = 'rgba(255,255,255,0.06)';
  for(let i=0;i<6;i++){
    ctx.beginPath();
    const ybase = H*0.45 + i*18;
    ctx.moveTo(0,H);
    for(let x=0;x<=W;x+=10){
      const y = ybase + Math.sin((x/60)+(t/800)+(i))+Math.cos((t/900))+ (i%2?12:-12);
      ctx.lineTo(x,y);
    }
    ctx.lineTo(W,H); ctx.closePath(); ctx.fill();
  }
  // floaters (bottles)
  const now = Date.now()/1000;
  floaters.forEach((f,idx)=>{
    const sway = Math.sin(now*f.speed + f.phase) * f.amp;
    const x = (f.x + sway*2) % W; const y = f.y + Math.sin((now+idx)/2)*6;
    drawBottle(x,y, f.design);
  })
}
function drawBottle(x,y, design){
  ctx.save(); ctx.translate(x,y);
  // bottle body
  ctx.beginPath(); ctx.ellipse(0,0,18,26,0,0,Math.PI*2);
  if(design==='Classic') ctx.fillStyle='#fff5d9';
  if(design==='Coral') ctx.fillStyle='#ffd6e0';
  if(design==='Starry') ctx.fillStyle='#ebf2ff';
  ctx.fill(); ctx.strokeStyle='rgba(0,0,0,0.06)'; ctx.stroke();
  // cork
  ctx.fillStyle='#cba46b'; ctx.fillRect(-8,-30,16,8);
  // little paper inside
  ctx.fillStyle='#fff'; ctx.fillRect(-8,-6,16,18);
  // sparkles for starry
  if(design==='Starry'){
    ctx.fillStyle='#ffef8a'; ctx.beginPath(); ctx.arc(6,-10,2,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#b9fffe'; ctx.beginPath(); ctx.arc(-6,0,1.6,0,Math.PI*2); ctx.fill();
  }
  ctx.restore();
}

let anim = 0; function loop(){ drawSea(anim); anim+=16; requestAnimationFrame(loop);} loop();

// UI wiring
const usernameInput = qs('#username'); const setUserBtn = qs('#setUser');
const tutorial = qs('#tutorial'); const tutorialGotIt = qs('#tutorialGotIt'); const tutorialSkip = qs('#tutorialSkip');
const preview = qs('#preview'); const noteBody = qs('#noteBody'); const noteTitle = qs('#noteTitle'); const sendBtn = qs('#sendBtn');
const indexList = qs('#indexList'); const collectedCount = qs('#collectedCount'); const designTag = qs('#designTag');
const unlock1 = qs('#unlock1'); const unlock2 = qs('#unlock2'); const unlock3 = qs('#unlock3');
const openCredits = qs('#openCredits'); const creditsModal = qs('#creditsModal'); const closeCredits = qs('#closeCredits');
const openCodes = qs('#openCodes'); const codeModal = qs('#codeModal'); const closeCodes = qs('#closeCodes'); const applyCode = qs('#applyCode'); const codeInput = qs('#codeInput');
const resetBtn = qs('#resetBtn');
const cooldownTag = qs('#cooldownTag');

function refreshUI(){
  qs('#userBadge').textContent = state.user||'Guest';
  preview.textContent = noteBody.value || 'Your note will show here.';
  collectedCount.textContent = state.collected.length;
  // unlock visuals
  unlock1.classList.remove('locked'); unlock1.textContent = 'Sent 1 ‚Äî Classic (unlocked)';
  if(state.unlocked[1]){unlock2.classList.remove('locked'); unlock2.textContent = 'Sent 5 ‚Äî Coral Bottle (unlocked)'} else {unlock2.classList.add('locked'); unlock2.textContent = 'Sent 5 ‚Äî Coral Bottle'}
  if(state.unlocked[2]){unlock3.classList.remove('locked'); unlock3.textContent = 'Sent 15 ‚Äî Starry Bottle (unlocked)'} else {unlock3.classList.add('locked'); unlock3.textContent = 'Sent 15 ‚Äî Starry Bottle'}
  designTag.textContent = state.designs[(state.unlocked[2]?2:(state.unlocked[1]?1:0))];
  renderIndex();
  saveLocal();
}

function renderIndex(){ indexList.innerHTML='';
  state.collected.slice().reverse().forEach((n,idx)=>{
    const el = document.createElement('div'); el.className='note-item';
    el.innerHTML = `<strong>${escapeHtml(n.title||'Untitled')}</strong><div class="muted">From: ${escapeHtml(n.from||'Unknown')}</div><div style="margin-top:6px">${escapeHtml(n.body)}</div><div class="muted" style="margin-top:6px">Design: ${escapeHtml(n.design||'Classic')}</div>`;
    indexList.appendChild(el);
  });
}

function escapeHtml(s){return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')}

// Pool management (shared within same browser)
function getPool(){try{return JSON.parse(localStorage.getItem(state.poolKey)||'[]')}catch(e){return []}}
function setPool(p){localStorage.setItem(state.poolKey, JSON.stringify(p))}

function pickRandomNote(excludeUser){const pool = getPool().filter(n=>n.from!==excludeUser); if(pool.length===0) return null; return pool[Math.floor(Math.random()*pool.length)];}

// Send bottle
function canSend(){return Date.now() > state.cooldownUntil}
function sendBottle(){ if(!state.user){alert('Please set a username first.'); return}
  if(!noteBody.value.trim()){alert('Write something in your note.'); return}
  if(!canSend()){alert('You are on cooldown. Please wait.'); return}
  const design = (state.unlocked[2])?state.designs[2]:((state.unlocked[1])?state.designs[1]:state.designs[0]);
  const note = {id: 'n_'+Math.random().toString(36).slice(2,9),from:state.user,title:noteTitle.value.trim(),body:noteBody.value.trim(),design:design,t:Date.now()};
  // push into pool
  const pool = getPool(); pool.push(note); setPool(pool);
  // increment send count
  state.sendCount++;
  // unlocks
  if(state.sendCount>=5) state.unlocked[1]=true; if(state.sendCount>=15) state.unlocked[2]=true;
  // cooldown 10s
  state.cooldownUntil = Date.now()+10000; updateCooldownUI();
  // sender receives a random note from pool (excluding their own) ‚Äî simulate immediate exchange
  const received = pickRandomNote(state.user);
  if(received){ state.collected.push(received); }
  else { // no other note; create a friendly fallback note
    state.collected.push({id:'fallback_'+Date.now(),from:'Ocean Friend',title:'Hello!',body:'Nice to meet you ‚Äî I found your bottle! Keep sharing ‚ù§Ô∏è',design:design,t:Date.now()})
  }
  // save and UI
  saveLocal(); refreshUI();
}

sendBtn.addEventListener('click', sendBottle);

// cooldown UI updater
function updateCooldownUI(){
  const now = Date.now(); if(now < state.cooldownUntil){ const s = Math.ceil((state.cooldownUntil-now)/1000); cooldownTag.innerHTML = `<span class="cooldown">Cooldown: ${s}s</span>`; sendBtn.disabled=true; setTimeout(updateCooldownUI,300); } else { cooldownTag.innerHTML=''; sendBtn.disabled=false; }
}
updateCooldownUI();

// Username flows
setUserBtn.addEventListener('click', ()=>{ const u = usernameInput.value.trim(); if(!u){alert('Choose a username'); return} state.user = u; loadOrInitUser(); tutorial.style.display='flex'; qs('#userBadge').textContent = state.user; saveLocal(); refreshUI();});
function loadOrInitUser(){ // ensure we have a saved object for this 'browser user'
  if(!state.user) return; const me = JSON.parse(localStorage.getItem(state.myKey)||'null') || {user:state.user,sendCount:0,unlocked:state.unlocked,collected:[],cooldownUntil:0}; me.user = state.user; state.sendCount = me.sendCount||0; state.unlocked = me.unlocked||state.unlocked; state.collected = me.collected||[]; state.cooldownUntil = me.cooldownUntil||0; saveLocal();}

// tutorial
tutorialGotIt.addEventListener('click', ()=>{ tutorial.style.display='none';}); tutorialSkip.addEventListener('click', ()=>{ tutorial.style.display='none';});

// Credits modal
openCredits.addEventListener('click', ()=>{ creditsModal.style.display='flex';}); closeCredits.addEventListener('click', ()=>{ creditsModal.style.display='none';});

// codes modal
openCodes.addEventListener('click', ()=>{ codeModal.style.display='flex';}); closeCodes.addEventListener('click', ()=>{ codeModal.style.display='none';}); applyCode.addEventListener('click', ()=>{ const code = codeInput.value.trim().toUpperCase(); if(!code){alert('Enter a code');return} if(code==='WELCOME'){ state.unlocked[1]=true; alert('Coral Bottle unlocked!'); } else if(code==='STARFALL'){ state.unlocked[2]=true; alert('Starry Bottle unlocked!'); } else if(code==='FREEBOTTLE'){ // give a random friendly note
  state.collected.push({id:'code_'+Date.now(),from:'CodeGiver',title:'A Gift',body:'Here is a mystery note just for you!',design: state.designs[Math.random()>0.5?1:0],t:Date.now()}); alert('You received a mystery note!'); }
  else { alert('Unknown code'); }
  codeInput.value=''; saveLocal(); refreshUI();});

// reset
resetBtn.addEventListener('click', ()=>{ if(confirm('Reset all local data for this browser?')){ localStorage.removeItem(state.myKey); state.user=null; state.sendCount=0; state.unlocked={0:true,1:false,2:false}; state.collected=[]; state.cooldownUntil=0; saveLocal(); refreshUI(); location.reload(); }});

// preview live
noteBody.addEventListener('input', ()=>{ preview.textContent = noteBody.value || 'Your note will show here.'}); noteTitle.addEventListener('input', ()=>{ /* optional */});

// initial render
refreshUI();

// explain limitation (inline) ‚Äî not repeated outside in chat
console.log('This is a single-file client demo. For real global sharing, a backend + database + security are needed.');

// Make a few pool notes to start (only if pool empty)
(function seedPool(){ const pool = getPool(); if(pool.length===0){ pool.push({id:'seed1',from:'Marina',title:'Hi from Spain',body:'I love the sea!',design:'Classic',t:Date.now()}); pool.push({id:'seed2',from:'Kai',title:'Hello',body:'Found your bottle ‚Äî waves are nice today',design:'Coral',t:Date.now()}); setPool(pool); } })();

</script>
</body>
</html>
