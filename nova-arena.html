<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nova Arena — Futuristic 3D Shooter</title>
  <style>
    html, body { margin: 0; padding: 0; overflow: hidden; height: 100%; }
    canvas { display: block; }
    #hud {
      position: fixed;
      top: 10px; left: 10px;
      color: white;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      font-size: 18px;
      background: rgba(0,0,0,0.35);
      padding: 6px 10px;
      border-radius: 8px;
      z-index: 10;
      user-select: none;
    }
    #start {
      position: fixed;
      inset: 0;
      background: radial-gradient(800px 500px at 50% -10%, rgba(62,243,255,.12), rgba(0,0,0,.8));
      display: grid;
      place-items: center;
      z-index: 20;
      color: #eaf2ff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      user-select: none;
    }
    #start .card {
      width: min(900px, 92vw);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 22px;
      padding: 22px;
      box-shadow: 0 24px 70px rgba(0,0,0,.45), inset 0 0 0 1px rgba(62,243,255,.18);
      text-align: center;
    }
    #start h1 { margin: .2rem 0 1rem; font-size: clamp(28px,4vw,46px); text-shadow: 0 0 18px rgba(62,243,255,.35); }
    #start .row { display:flex;gap:10px;justify-content:center;flex-wrap:wrap }
    #start button {
      appearance:none;border:0;cursor:pointer;color:#eaf2ff;font-weight:900;letter-spacing:.5px;
      padding:10px 14px;border-radius:14px;background:linear-gradient(180deg,#15233e,#0a1426);
      border:1px solid rgba(62,243,255,.25);box-shadow:0 6px 18px rgba(0,0,0,.35),inset 0 0 0 1px rgba(62,243,255,.14);
    }
    #crosshair {
      position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%);
      width: 14px; height: 14px; border: 2px solid rgba(255,255,255,.85); border-radius: 50%;
      box-shadow: 0 0 10px rgba(62,243,255,.5);
      pointer-events: none; z-index: 9;
    }
    /* Touch controls */
    #touch-left, #touch-right, #touch-fire {
      position: fixed; bottom: 24px; width: 140px; height: 140px; border-radius: 50%;
      background: radial-gradient(60% 60% at 30% 30%, rgba(62,243,255,.18), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.2);
      touch-action: none; user-select: none; display: none; z-index: 30;
    }
    #touch-left { left: 24px; }
    #touch-right { right: 24px; }
    #touch-fire {
      right: 190px; width: 100px; height: 100px; border-radius: 50%;
      display: none; place-items: center; font-weight: 900; color: #eaf2ff;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.22), rgba(255,255,255,.07));
    }
    @media (pointer: coarse) {
      #touch-left, #touch-right, #touch-fire { display: grid; }
    }
  </style>
</head>
<body>
  <div id="hud">HP: <span id="hp">100</span></div>
  <div id="crosshair"></div>

  <div id="start">
    <div class="card">
      <h1>NOVA ARENA</h1>
      <p style="margin:-6px 0 12px;opacity:.85">WASD + Mouse on laptop • Virtual sticks + tap to shoot on tablet</p>
      <div class="row">
        <button id="btn-start">▶️ Quick Start</button>
        <button id="btn-full">⛶ Fullscreen</button>
      </div>
      <small style="display:block;margin-top:10px;opacity:.8">Tip: Click the canvas to lock the mouse for smooth aim on desktop.</small>
    </div>
  </div>

  <!-- Touch controls -->
  <div id="touch-left" aria-hidden="true"></div>
  <div id="touch-right" aria-hidden="true"></div>
  <div id="touch-fire" aria-hidden="true">FIRE</div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js"></script>
  <script>
  // ====== BASIC ENGINE ======
  const DPR = Math.min(2, window.devicePixelRatio || 1);
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(70, 1, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setPixelRatio(DPR);
  document.body.appendChild(renderer.domElement);

  const hemi = new THREE.HemisphereLight(0x66ccff, 0x090909, 1.1); scene.add(hemi);
  const dir = new THREE.DirectionalLight(0xffffff, 0.7); dir.position.set(3,6,2); scene.add(dir);

  function resize(){
    const w = innerWidth, h = innerHeight;
    renderer.setSize(w, h, false);
    camera.aspect = w/h; camera.updateProjectionMatrix();
  }
  addEventListener('resize', resize, {passive:true}); resize();

  // ====== STATE ======
  const state = {
    running:false, paused:false, last:0, dt:0.016,
    player:null, bots:[], impacts:[], objects:[],
    ammo:30, reserve:90, credits:0
  };

  const hudHP = document.getElementById('hp');
  function updateHUD(){
    if(state.player) hudHP.textContent = Math.max(0, Math.floor(state.player.hp));
  }

  // ====== MAP ======
  function clearWorld(){
    state.bots.forEach(b=>scene.remove(b.mesh)); state.bots=[];
    state.objects.forEach(o=>scene.remove(o)); state.objects=[];
    state.impacts.forEach(i=>scene.remove(i.m)); state.impacts=[];
    if(state.player){ scene.remove(state.player.mesh); state.player=null; }
  }

  function block(x,y,z,w,h,d,c){
    const m=new THREE.Mesh(new THREE.BoxGeometry(w,h,d),
      new THREE.MeshStandardMaterial({color:c, metalness:0.3, roughness:0.5, emissive:c}));
    m.position.set(x,y,z); scene.add(m); state.objects.push(m); return m;
  }

  function loadMap(){
    clearWorld();
    const floor = new THREE.Mesh(new THREE.PlaneGeometry(40,40),
      new THREE.MeshStandardMaterial({color:0x0e1327, metalness:0.2, roughness:0.8}));
    floor.rotation.x=-Math.PI/2; scene.add(floor); state.objects.push(floor);
    for(let i=0;i<10;i++){
      block(-10+i*2,1,-2,1,2,4,0x2a234f);
      block(-10+i*2,1, 2,1,2,4,0x402a7f);
    }
  }

  // ====== PLAYER ======
  const raycaster = new THREE.Raycaster();
  function spawnPlayer(){
    const geo = new THREE.CapsuleGeometry(0.35, 0.8, 8, 16);
    const mat = new THREE.MeshStandardMaterial({color:0x3ef3ff, emissive:0x0, metalness:0.2, roughness:0.4});
    const mesh = new THREE.Mesh(geo, mat); mesh.position.set(0,1,0); mesh.castShadow=true; scene.add(mesh);
    state.player = { mesh, yaw:0, pitch:0, speed:6, jump:0, onGround:true, hp:100, fireCd:0 };
    camera.position.set(0,1.4,3); camera.lookAt(mesh.position);
    updateHUD();
  }

  // ====== BOTS ======
  function botSpec(level){ if(level==='easy') return {speed:2.6, fire:1.2, aimErr:0.15, dmg:8}; if(level==='hard') return {speed:4.2, fire:0.5, aimErr:0.03, dmg:16}; return {speed:3.4, fire:0.8, aimErr:0.08, dmg:12}; }
  function makeBot(i){
    const geo=new THREE.CapsuleGeometry(0.35,0.8,8,16);
    const mat=new THREE.MeshStandardMaterial({color: [0xff6b6b,0xffd166,0x9dff57][i%3], metalness:0.2, roughness:0.6});
    const mesh=new THREE.Mesh(geo,mat); mesh.position.set((Math.random()-0.5)*12,1,(Math.random()-0.5)*12);
    const lvl = ['easy','med','hard'][i%3]; const spec = botSpec(lvl);
    return {mesh, hp:120, fireCd:0, spec};
  }
  function spawnBots(n){ for(let i=0;i<n;i++){ const b=makeBot(i); state.bots.push(b); scene.add(b.mesh);} }

  function botShoot(b, p){
    const dir = p.mesh.position.clone().sub(b.mesh.position).normalize();
    dir.x += (Math.random()-0.5)*b.spec.aimErr;
    dir.y += (Math.random()-0.2)*b.spec.aimErr;
    raycaster.set(b.mesh.position.clone().setY(1.2), dir);
    const hit = raycaster.intersectObjects([p.mesh], true)[0];
    if(hit){ hurtPlayer(b.spec.dmg); spawnImpact(hit.point); }
  }

  function tickBots(dt){
    const p=state.player; if(!p) return;
    for(const b of state.bots){
      const to = p.mesh.position.clone().sub(b.mesh.position); const dist=to.length(); to.y=0; to.normalize();
      const strafe = new THREE.Vector3(-to.z,0,to.x).multiplyScalar(Math.sin(state.last*0.002+dist)*0.5);
      const vel = to.multiplyScalar(b.spec.speed*dt).add(strafe); b.mesh.position.add(vel);
      b.mesh.lookAt(p.mesh.position.clone().setY(1));
      b.fireCd-=dt; if(b.fireCd<=0 && dist<12){ b.fireCd = b.spec.fire; botShoot(b, p); }
    }
  }

  // ====== COMBAT ======
  function gunSpec(){ return {cd:0.12, damage:30, spread:0.01}; }
  function triggerFire(){
    if(!state.running) return;
    const p=state.player; if(!p) return;
    if(p.fireCd>0) return;
    p.fireCd = gunSpec().cd;
    impactRay(gunSpec().damage, gunSpec().spread);
  }
  function impactRay(damage, spread){
    const dir = new THREE.Vector3(0,0,-1).applyEuler(new THREE.Euler(state.player.pitch, state.player.yaw, 0));
    dir.x += (Math.random()-0.5)*spread*2; dir.y += (Math.random()-0.5)*spread*2;
    raycaster.set(camera.position.clone(), dir.normalize());
    const hit = raycaster.intersectObjects(state.bots.map(b=>b.mesh), true)[0];
    if(hit){
      spawnImpact(hit.point);
      const bot = state.bots.find(b=> b.mesh===hit.object || b.mesh.children?.includes?.(hit.object));
      if(bot){ bot.hp -= damage; if(bot.hp<=0){ pop(bot.mesh.position); scene.remove(bot.mesh); state.bots = state.bots.filter(x=>x!==bot); state.credits+=50; } }
    }
  }
  function spawnImpact(p){
    const sGeo=new THREE.SphereGeometry(0.06,6,6);
    const sMat=new THREE.MeshBasicMaterial({color:0x3ef3ff, transparent:true, opacity:0.9});
    const s=new THREE.Mesh(sGeo,sMat); s.position.copy(p); scene.add(s);
    state.impacts.push({m:s,t:0});
  }
  function pop(pos){
    const g=new THREE.SphereGeometry(0.2,8,8);
    const m=new THREE.MeshBasicMaterial({color:0xff2bd6});
    for(let i=0;i<10;i++){
      const s=new THREE.Mesh(g,m.clone()); s.position.copy(pos);
      const v=new THREE.Vector3((Math.random()-0.5)*4,Math.random()*2,(Math.random()-0.5)*4);
      state.impacts.push({m:s,t:0}); scene.add(s); s.userData.v=v;
    }
  }

  function hurtPlayer(d){
    if(!state.player) return;
    state.player.hp -= d;
    if(state.player.hp<=0){ state.player.hp=0; gameOver(); }
    updateHUD();
  }

  // ====== CONTROLS ======
  const keys={};
  addEventListener('keydown',e=>{ keys[e.key.toLowerCase()]=true; if(e.code==='Space') e.preventDefault(); });
  addEventListener('keyup',e=>{ keys[e.key.toLowerCase()]=false; });

  let pointerLocked=false;
  const lock = ()=>{ const c=renderer.domElement; c.requestPointerLock?.(); };
  document.addEventListener('pointerlockchange', ()=>{
    pointerLocked = (document.pointerLockElement===renderer.domElement);
  });
  renderer.domElement.addEventListener('click',()=>{ if(!pointerLocked) lock(); });

  addEventListener('mousemove',(e)=>{
    if(!pointerLocked || !state.running) return;
    const s=0.002;
    state.player.yaw   -= e.movementX*s;
    state.player.pitch -= e.movementY*s;
    state.player.pitch = Math.max(-1.2, Math.min(1.2, state.player.pitch));
  });
  addEventListener('mousedown',(e)=>{ if(e.button===0) triggerFire(); });

  // Touch controls
  const tLeft = document.getElementById('touch-left');
  const tRight = document.getElementById('touch-right');
  const tFire = document.getElementById('touch-fire');
  let joy = {active:false, id:null, cx:0, cy:0, x:0, y:0};
  let look = {active:false, id:null, px:0, py:0};
  function inEl(el, x, y){ const r=el.getBoundingClientRect(); return x>=r.left&&x<=r.right&&y>=r.top&&y<=r.bottom; }

  addEventListener('touchstart', (e)=>{
    for(const t of e.changedTouches){
      if(!joy.active && inEl(tLeft, t.clientX, t.clientY)){
        joy.active=true; joy.id=t.identifier; joy.cx=t.clientX; joy.cy=t.clientY; joy.x=joy.y=0;
      } else if(!look.active && inEl(tRight, t.clientX, t.clientY)){
        look.active=true; look.id=t.identifier; look.px=t.clientX; look.py=t.clientY;
      } else if(inEl(tFire, t.clientX, t.clientY)){
        triggerFire();
      }
    }
  }, {passive:true});

  addEventListener('touchmove', (e)=>{
    for(const t of e.changedTouches){
      if(joy.active && t.identifier===joy.id){
        const dx=t.clientX-joy.cx, dy=t.clientY-joy.cy;
        const m = Math.min(1, Math.hypot(dx,dy)/70);
        joy.x = (dx/Math.max(1,Math.abs(dx))) * m;
        joy.y = (dy/Math.max(1,Math.abs(dy))) * m;
      }
      if(look.active && t.identifier===look.id){
        const dx=t.clientX-look.px, dy=t.clientY-look.py;
        look.px=t.clientX; look.py=t.clientY;
        state.player.yaw   -= dx*0.004;
        state.player.pitch -= dy*0.004;
        state.player.pitch = Math.max(-1.2, Math.min(1.2, state.player.pitch));
      }
    }
  }, {passive:true});

  addEventListener('touchend', (e)=>{
    for(const t of e.changedTouches){
      if(joy.active && t.identifier===joy.id){ joy.active=false; joy.x=joy.y=0; }
      if(look.active && t.identifier===look.id){ look.active=false; }
    }
  }, {passive:true});

  // ====== TICK ======
  function tickPlayer(dt){
    const p=state.player; if(!p) return;
    let x=0,z=0;
    if(keys['w']||keys['arrowup']) z-=1;
    if(keys['s']||keys['arrowdown']) z+=1;
    if(keys['a']||keys['arrowleft']) x-=1;
    if(keys['d']||keys['arrowright']) x+=1;
    x += joy.x; z += -joy.y;

    const fwd = new THREE.Vector3(Math.sin(p.yaw),0,Math.cos(p.yaw)*-1);
    const right = new THREE.Vector3().crossVectors(fwd,new THREE.Vector3(0,1,0)).normalize();
    const move = new THREE.Vector3().addScaledVector(fwd,z).addScaledVector(right,x);
    if(move.length()>0) move.normalize().multiplyScalar(p.speed*dt*5);
    p.mesh.position.add(move);

    // simple ground
    p.mesh.position.y = Math.max(1, p.mesh.position.y + p.jump);
    if(p.mesh.position.y>1) { p.jump -= 9.8*dt; if(p.mesh.position.y<=1){ p.mesh.position.y=1; p.jump=0; } }

    const camOff = new THREE.Vector3(0,1.4,3).applyEuler(new THREE.Euler(0,p.yaw,0));
    camera.position.copy(p.mesh.position).add(camOff);
    camera.lookAt(p.mesh.position);
  }

  function animate(ts){
    state.dt = state.last ? Math.min(0.05, (ts-state.last)/1000) : 0.016; state.last=ts||0;
    if(state.running && !state.paused){
      for(const i of state.impacts){
        i.t += state.dt;
        if(i.m.userData.v){ i.m.position.add(i.m.userData.v.clone().multiplyScalar(state.dt)); i.m.userData.v.multiplyScalar(0.96); }
        i.m.material.opacity = Math.max(0, 1-i.t*2);
        if(i.t>1){ scene.remove(i.m); }
      }
      state.impacts = state.impacts.filter(i=>i.t<=1);
      tickPlayer(state.dt);
      tickBots(state.dt);
    }
    renderer.render(scene, camera);
    requestAnimationFrame(animate);
  }
  requestAnimationFrame(animate);

  function gameOver(){
    state.running=false;
    alert('You were eliminated. Credits: '+state.credits+' | Click Quick Start to play again.');
    document.getElementById('start').style.display='grid';
  }

  // ====== UI ======
  document.getElementById('btn-start').onclick = ()=>{
    loadMap(); spawnPlayer(); spawnBots(3);
    state.running=true; document.getElementById('start').style.display='none';
    updateHUD();
  };
  document.getElementById('btn-full').onclick = ()=>{
    if(!document.fullscreenElement) document.documentElement.requestFullscreen?.();
    else document.exitFullscreen?.();
  };

  loadMap(); // preload background
  </script>
</body>
</html>
